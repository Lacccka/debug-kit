/* base.css — resets, a11y helpers, utilities (tightly aligned with tokens.css) */

/* ------------------------------------------------------------------ */
/* 0) GLOBAL PREFERENCES                                               */
/* ------------------------------------------------------------------ */
:root {
    /* объявляем поддержку обеих цветовых схем, чтобы UA правильно красил формы/скролл */
    color-scheme: dark light;
}

/* ------------------------------------------------------------------ */
/* 1) TINY RESET & TYPOGRAPHY BASE                                     */
/*    (tokens.css уже делает часть через :host; тут — общедомовые вещи) */
/* ------------------------------------------------------------------ */
*,
*::before,
*::after {
    box-sizing: border-box;
}

html,
body {
    margin: 0;
    padding: 0;
}

:host,
html,
body {
    font: var(--dk-font-base);
    -webkit-text-size-adjust: 100%;
    text-rendering: optimizeLegibility;
}

/* убираем дефолтные отступы типографики и списков — контролируем через утилиты */
h1,
h2,
h3,
h4,
h5,
h6,
p,
figure,
blockquote,
dl,
dd {
    margin: 0;
}
ul[role="list"],
ol[role="list"] {
    list-style: none;
    padding: 0;
    margin: 0;
}

/* медиа адаптивно по ширине контейнера */
img,
svg,
video,
canvas,
audio,
iframe {
    max-width: 100%;
    height: auto;
}

/* кнопки и кликабельные устранения «вир. кнопок» на iOS */
button,
input,
select,
textarea {
    font: inherit;
    color: inherit;
}
button {
    background: none;
    border: none;
    padding: 0;
}

/* ------------------------------------------------------------------ */
/* 2) A11Y HELPERS                                                     */
/* ------------------------------------------------------------------ */
/* Visually hidden (но доступно для скринридеров) */
.sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    margin: -1px !important;
    padding: 0 !important;
    overflow: hidden !important;
    clip: rect(0 0 0 0) !important;
    clip-path: inset(50%) !important;
    white-space: nowrap !important;
    border: 0 !important;
}
/* Делает .sr-only «видимым» при фокусе клавиатурой */
.sr-only-focusable:focus,
.sr-only-focusable:focus-within {
    position: static !important;
    width: auto !important;
    height: auto !important;
    margin: 0 !important;
    overflow: visible !important;
    clip: auto !important;
    clip-path: none !important;
    white-space: normal !important;
}

/* Глобальное фокус-кольцо (низкая специфичность) */
:where(
        a,
        button,
        [role="button"],
        input,
        select,
        textarea,
        summary
    ):focus-visible {
    outline: none;
    box-shadow: var(--dk-focus-ring);
}

/* Утилита форс-фокуса, если нужно применить к произвольному контейнеру */
.focus-ring:focus-visible {
    box-shadow: var(--dk-focus-ring);
    outline: none;
}

/* Высокая контрастность и forced-colors */
@media (forced-colors: active) {
    * {
        forced-color-adjust: auto;
    }
}

/* Reduced motion — отключаем анимации и автопрокрутку */
@media (prefers-reduced-motion: reduce) {
    * {
        animation: none !important;
        transition: none !important;
        scroll-behavior: auto !important;
    }
}

/* ------------------------------------------------------------------ */
/* 3) SCROLLBARS                                                       */
/* ------------------------------------------------------------------ */
/* Токены для скроллбаров (используем имеющиеся цветовые переменные) */
:root {
    --dk-scrollbar-thumb: color-mix(
        in oklab,
        var(--dk-color-border, #23252b) 70%,
        #000 30%
    );
    --dk-scrollbar-thumb-hover: color-mix(
        in oklab,
        var(--dk-color-border, #23252b) 50%,
        #000 50%
    );
}

/* Firefox */
* {
    scrollbar-width: thin;
    scrollbar-color: var(--dk-scrollbar-thumb) transparent;
}

/* WebKit/Chromium */
*::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}
*::-webkit-scrollbar-thumb {
    background: var(--dk-scrollbar-thumb);
    border-radius: 9999px;
    border: 2px solid transparent;
    background-clip: content-box;
}
*::-webkit-scrollbar-thumb:hover {
    background: var(--dk-scrollbar-thumb-hover);
}

/* ------------------------------------------------------------------ */
/* 4) SEPARATORS & MISC                                                */
/* ------------------------------------------------------------------ */
.dk-sep {
    height: var(--dk-border-width);
    background: var(--dk-color-border);
    margin: var(--dk-space-2) 0; /* был var(--dk-space-sm) */
}

/* Контейнер прокрутки-списка */
.dk-scroll-list {
    --dk-scroll-max-h: 200px;
    max-height: var(--dk-scroll-max-h);
    overflow: auto;
}

/* Узкий инпут (фикс. ширина) */
.dk-input-sm {
    width: 64px;
}

/* ------------------------------------------------------------------ */
/* 5) SPACING UTILITIES (шкала из tokens: --dk-space-1..8)             */
/*    Только базовые, без «взрыва» классов. При желании расширим.     */
/* ------------------------------------------------------------------ */
:root {
    /* alias-синтаксис для утилит (необязательно, но читаемо) */
    --_s1: var(--dk-space-1);
    --_s2: var(--dk-space-2);
    --_s3: var(--dk-space-3);
    --_s4: var(--dk-space-4);
    --_s5: var(--dk-space-5);
    --_s6: var(--dk-space-6);
    --_s7: var(--dk-space-7);
    --_s8: var(--dk-space-8);
}

/* margin-bottom */
.dk-mb-1 {
    margin-bottom: var(--_s1);
}
.dk-mb-2 {
    margin-bottom: var(--_s2);
}
.dk-mb-3 {
    margin-bottom: var(--_s3);
}
.dk-mb-4 {
    margin-bottom: var(--_s4);
}
.dk-mb-5 {
    margin-bottom: var(--_s5);
}

/* margin-left */
.dk-ml-1 {
    margin-left: var(--_s1);
}
.dk-ml-2 {
    margin-left: var(--_s2);
}
.dk-ml-3 {
    margin-left: var(--_s3);
}
.dk-ml-4 {
    margin-left: var(--_s4);
}
.dk-ml-5 {
    margin-left: var(--_s5);
}

/* при необходимости добавим dk-m{t|r}-* и padding-утилиты */

/* ------------------------------------------------------------------ */
/* 6) FORMS — FIELDS, INPUTS, STATES                                   */
/* ------------------------------------------------------------------ */
/* Группа поля */
.dk-field {
    display: flex;
    flex-direction: column;
    gap: var(--dk-space-2); /* был var(--dk-space-sm) */
    margin-bottom: var(--dk-space-4); /* был var(--dk-space-md) */
}
.dk-field > label {
    font-size: 0.875rem;
    color: var(--dk-color-text-muted);
}

/* Базовые контролы форм */
:where(
        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="url"],
        input[type="password"],
        input[type="search"],
        input[type="tel"],
        select,
        textarea
    ) {
    width: 100%;
    appearance: none;
    background: var(--input-bg, var(--dk-color-bg-3));
    color: var(--input-text, var(--dk-color-text));
    border: var(--dk-border-width) var(--dk-border-style)
        var(--input-border, var(--dk-color-border));
    border-radius: var(--dk-radius);
    padding: var(--dk-space-2) var(--dk-space-3);
    line-height: 1.4;
    transition: border-color var(--dk-dur) var(--dk-ease-out),
        background-color var(--dk-dur) var(--dk-ease-out);
}
:where(select) {
    background-image: linear-gradient(45deg, transparent 50%, currentColor 50%),
        linear-gradient(135deg, currentColor 50%, transparent 50%);
    background-position: right 0.9rem top 1.1rem, right 0.6rem top 1.1rem;
    background-size: 6px 6px, 6px 6px;
    background-repeat: no-repeat;
    padding-right: var(--dk-space-6);
}
:where(textarea) {
    resize: vertical;
    min-height: 5.5rem;
}

:where(input, select, textarea):hover {
    border-color: var(
        --input-border-hover,
        color-mix(
            in oklab,
            var(--dk-color-border) 70%,
            var(--dk-color-accent) 30%
        )
    );
}
:where(input, select, textarea):focus-visible {
    outline: none;
    border-color: var(--input-border-focus, var(--dk-color-accent));
    box-shadow: var(--dk-focus-ring);
}

:where(input, select, textarea):disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Состояния валидности */
.is-invalid,
:where(input, select, textarea).is-invalid {
    border-color: var(--dk-danger);
    box-shadow: 0 0 0 calc(var(--dk-focus-ring-offset) + 1px)
        color-mix(in oklab, var(--dk-danger) 35%, transparent);
}
.is-valid,
:where(input, select, textarea).is-valid {
    border-color: var(--dk-success);
    box-shadow: 0 0 0 calc(var(--dk-focus-ring-offset) + 1px)
        color-mix(in oklab, var(--dk-success) 35%, transparent);
}

/* Текст подсказки/ошибки под полем */
.dk-field .hint {
    font-size: 0.8125rem;
    color: var(--dk-color-text-muted);
}
.dk-field .error {
    font-size: 0.8125rem;
    color: var(--dk-danger);
}

/* ------------------------------------------------------------------ */
/* 7) BUTTONS                                                          */
/* ------------------------------------------------------------------ */
.btn {
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--dk-space-2);
    border-radius: var(--dk-radius);
    padding: var(--dk-space-2) var(--dk-space-4);
    line-height: 1.25;
    border: var(--dk-border-width) var(--dk-border-style)
        var(--btn-border, var(--dk-color-border));
    background: var(--btn-bg, var(--dk-color-bg-3));
    color: var(--btn-text, var(--dk-color-text));
    box-shadow: var(--btn-shadow, var(--dk-elevation-1));
    transition: transform var(--dk-dur-fast) var(--dk-ease-out),
        background-color var(--dk-dur) var(--dk-ease-out),
        border-color var(--dk-dur) var(--dk-ease-out);
}
.btn:hover {
    background: var(--btn-bg-hover, var(--dk-color-bg));
    border-color: var(--btn-border, var(--dk-color-border-accent));
}
.btn:active {
    transform: scale(0.98);
}
.btn:focus-visible {
    outline: none;
    box-shadow: var(--dk-focus-ring);
    border-color: var(--dk-color-border-accent);
}

/* Вариант «primary» (использует семантические токены кнопок из tokens.css) */
.btn--primary {
    --btn-bg: var(--dk-color-accent);
    --btn-text: var(--dk-color-on-accent);
    --btn-border: var(--dk-color-border-accent);
    --btn-shadow: var(--dk-elevation-1);
}
.btn--primary:hover {
    --btn-bg: color-mix(in oklab, var(--dk-color-accent) 88%, black 12%);
}
.btn--primary:active {
    --btn-bg: color-mix(in oklab, var(--dk-color-accent) 76%, black 24%);
}

/* Disabled */
.btn:disabled,
.btn[aria-disabled="true"] {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* ------------------------------------------------------------------ */
/* 8) OUTLINE UTILITIES (explicit)                                     */
/* ------------------------------------------------------------------ */
.dk-outline-error {
    outline: 2px solid var(--dk-outline-error) !important;
}
.dk-outline-error-dashed {
    outline: 2px dashed var(--dk-outline-error) !important;
}
.dk-outline-info {
    outline: 2px solid var(--dk-outline-info) !important;
}
